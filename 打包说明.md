# Kissu App 自动打包脚本使用说明

## 脚本文件说明

### 1. `build_apk.bat` - 完整版批处理脚本
- **功能最全面**，包含详细的错误处理和进度显示
- 支持彩色输出，便于查看进度
- 自动备份和恢复原始文件
- 包含完整的错误处理机制

### 2. `build_apk.ps1` - PowerShell脚本
- **推荐使用**，功能强大且稳定
- 支持参数：`-SkipClean`（跳过清理）、`-Verbose`（详细输出）
- 更好的错误处理和文件操作
- 支持UTF-8编码

### 3. `quick_build.bat` - 快速打包脚本
- **最简洁**，适合快速打包
- 输出信息较少，打包速度最快
- 适合熟悉流程的开发者使用

## 支持的渠道

| 渠道代码 | 渠道名称 | 说明 |
|---------|---------|------|
| kissu_xiaomi | 小米 | 小米应用商店 |
| kissu_huawei | 华为 | 华为应用市场 |
| kissu_rongyao | 荣耀 | 荣耀应用市场 |
| kissu_vivo | vivo | vivo应用商店 |
| kissu_oppo | oppo | OPPO软件商店 |

## 使用方法

### 方法一：使用批处理脚本（推荐新手）
```bash
# 双击运行或在命令行执行
build_apk.bat
```

### 方法二：使用PowerShell脚本（推荐）
```powershell
# 基本使用
.\build_apk.ps1

# 跳过清理步骤（更快）
.\build_apk.ps1 -SkipClean

# 显示详细输出
.\build_apk.ps1 -Verbose

# 组合使用
.\build_apk.ps1 -SkipClean -Verbose
```

### 方法三：使用快速脚本
```bash
# 双击运行或在命令行执行
quick_build.bat
```

## 输出文件

所有生成的APK文件将保存在 `build\apk\` 目录下：

- `kissu_kissu_xiaomi_小米.apk`
- `kissu_kissu_huawei_华为.apk`
- `kissu_kissu_rongyao_荣耀.apk`
- `kissu_kissu_vivo_vivo.apk`
- `kissu_kissu_oppo_oppo.apk`

## 修改的文件

脚本会自动修改以下文件中的渠道设置：
- `lib\network\interceptor\business_header_interceptor.dart` 第170行

修改内容：
```dart
// 原始
_cachedChannel ??= Platform.isAndroid ? 'kissu_oppo' : 'Android';

// 修改为对应渠道
_cachedChannel ??= Platform.isAndroid ? 'kissu_xiaomi' : 'Android';
```

## 注意事项

1. **运行环境**：确保在项目根目录运行脚本
2. **Flutter环境**：确保Flutter已安装并添加到PATH
3. **权限问题**：PowerShell脚本可能需要设置执行策略
4. **文件备份**：脚本会自动备份和恢复原始文件
5. **构建时间**：完整打包5个渠道大约需要10-20分钟

## 故障排除

### PowerShell执行策略问题
```powershell
# 临时允许脚本执行
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Flutter环境问题
```bash
# 检查Flutter版本
flutter --version

# 检查Flutter环境
flutter doctor
```

### 文件权限问题
- 确保有写入 `build\apk\` 目录的权限
- 确保有修改 `lib\network\interceptor\business_header_interceptor.dart` 的权限

## 自定义渠道

如需添加新渠道，请修改脚本中的渠道配置：

### 批处理脚本
```batch
set "CHANNELS=kissu_xiaomi kissu_huawei kissu_rongyao kissu_vivo kissu_oppo kissu_new"
set "CHANNEL_NAMES=小米 华为 荣耀 vivo oppo 新渠道"
```

### PowerShell脚本
```powershell
$channels = @{
    "kissu_xiaomi" = "小米"
    "kissu_huawei" = "华为"
    "kissu_rongyao" = "荣耀"
    "kissu_vivo" = "vivo"
    "kissu_oppo" = "oppo"
    "kissu_new" = "新渠道"
}
```

## 性能优化建议

1. **使用SSD硬盘**：可以显著提升构建速度
2. **增加内存**：建议至少8GB内存
3. **关闭杀毒软件**：临时关闭实时保护可以提升速度
4. **使用SkipClean参数**：PowerShell脚本支持跳过清理步骤

