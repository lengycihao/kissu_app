# Kissu App 项目交接文档

## 项目概览

**项目名称**: Kissu App  
**项目类型**: Flutter移动应用（情侣定位社交应用）  
**支持平台**: Android（主要）、iOS  
**开发语言**: Dart (Flutter) + Kotlin (Android)  
**架构模式**: GetX + 服务化架构  

  项目结构

  目录结构
```
lib/
├── main.dart                    # 应用入口，服务初始化
├── constants/                   # 常量定义
├── model/                      # 数据模型
├── models/                     # 业务模型
├── network/                    # 网络层架构
│   ├── http_engine.dart        # HTTP引擎
│   ├── http_managerN.dart      # HTTP管理器
│   ├── interceptor/            # 网络拦截器
│   ├── public/                 # 公共API和服务
│   └── tools/                  # 网络工具
├── pages/                      # 页面和控制器
│   ├── splash/                 # 启动页（隐私合规）
│   ├── home/                   # 首页（主界面）
│   ├── login/                  # 登录相关
│   ├── location/               # 定位功能
│   ├── track/                  # 地图轨迹
│   ├── mine/                   # 个人中心
│   ├── vip/                    # VIP功能
│   └── phone_history/          # 用机记录
├── routers/                    # 路由配置
├── services/                   # 核心服务层
├── utils/                      # 工具类
└── widgets/                    # 自定义组件

android/
├── app/
│   ├── src/main/kotlin/com/yuluo/kissu/
│   │   ├── MainActivity.kt     # 主Activity（支付功能）
│   │   └── ForegroundLocationService.kt  # 前台定位服务
│   ├── build.gradle.kts        # Android构建配置
│   └── libs/                   # 本地依赖库
```

  核心业务功能

1. **用户系统**
   - 手机号登录/注册
   - 用户信息管理
   - 恋爱关系绑定

2. **定位功能**
   - 实时位置获取
   - 位置上报
   - 距离计算
   - 前台定位服务

3. **地图功能**
   - 高德地图集成
   - 轨迹显示
   - 位置标记

4. **社交功能**
   - 情侣绑定
   - 分享功能
   - 消息中心

5. **VIP功能**
   - 套餐购买
   - 微信支付
   - 支付宝支付

6. **其他功能**
   - 用机记录
   - 系统设置
   - 权限管理

  技术架构

  前端架构 (Flutter)

**状态管理**: GetX  
**网络请求**: Dio + 自定义拦截器  
**路由管理**: GetX Navigator  
**数据存储**: SharedPreferences + FlutterSecureStorage  

**核心服务**:
- `AuthService`: 用户认证服务
- `PaymentService`: 支付服务  
- `SimpleLocationService`: 定位服务
- `PrivacyComplianceManager`: 隐私合规管理
- `ShareService`: 分享服务
- `JPushService`: 推送服务

   网络架构

**基础URL**: `https://service-api.ikissu.cn`  
**核心组件**:
- `HttpEngine`: HTTP引擎封装
- `HttpManagerN`: 网络管理器
- `BusinessHeaderInterceptor`: 业务请求头拦截器
- `ApiResponseInterceptor`: 响应处理拦截器
- `CacheControlInterceptor`: 缓存控制
- `NetworkDebounceInterceptor`: 防抖处理

  支付架构

**支持平台**: 微信支付、支付宝支付  
**实现方式**: 原生Android集成 + Flutter Bridge  
**核心文件**:
- `lib/services/payment_service.dart`: Flutter支付服务
- `android/.../MainActivity.kt`: Android支付实现

 
  第三方SDK配置

**高德地图**:
- API Key: `38edb925a25f22e3aae2f86ce7f2ff3b`
- 隐私合规: 用户同意后初始化

**微信支付**:
- AppID: `wxca15128b8c388c13`
- 商户号: 动态获取
- Universal Link: `https://ulink.ikissu.cn/`

**支付宝支付**:
- 集成方式: SDK集成
- 版本: `15.8.11`

**友盟分享**:
- AppKey: `6879fbe579267e0210b67be9`
- 微信AppID: `wxca15128b8c388c13`
- QQ AppKey: `102797447`

**极光推送**:
- 延迟初始化（隐私合规）

**OpenInstall**:
- AppKey: `eb24o3`
- 剪贴板功能: 已禁用（隐私合规）

 
项目支持多渠道自动打包，已配置脚本：

- `build_apk.bat`: 批处理脚本
- `build_apk.ps1`: PowerShell脚本（推荐）
- `quick_build.bat`: 快速打包

**支持渠道**:
- kissu_xiaomi (小米)
- kissu_huawei (华为)
- kissu_rongyao (荣耀)
- kissu_vivo (vivo)
- kissu_oppo (oppo)

**使用方法**:
```bash
# PowerShell方式（推荐）
.\build_apk.ps1

# 快速打包
.\quick_build.bat
```

  渠道配置

渠道信息在 `lib/network/interceptor/business_header_interceptor.dart` 第170行配置：
```dart
_cachedChannel ??= Platform.isAndroid ? 'kissu_oppo' : 'Android';
```

打包脚本会自动修改此配置并生成对应渠道的APK。
 
  **SDK延迟初始化**
   - 所有第三方SDK在用户同意后初始化
   - 包括：极光推送、高德地图、友盟分享、OpenInstall

  **数据收集控制**
   - 设备信息（ANDROID ID、WIFI SSID等）在用户同意后收集
   - 敏感数据上报在合规后进行

  核心合规文件

- `lib/services/privacy_compliance_manager.dart`: 隐私合规管理器
- `lib/pages/splash/splash_page.dart`: 启动页隐私弹窗
- `privacy_compliance_test.md`: 合规测试文档
 
  

**核心服务**: `SimpleLocationService`  
**地图SDK**: 高德地图  
**权限管理**: `LocationPermissionService`  
**前台服务**: `ForegroundLocationService`  

  

- **Flutter**: 3.8.0+
- **Dart**: 3.8.0+
- **Android Studio**: 最新版
- **Kotlin**: 1.7+
- **Java**: 11+

### 8.2 依赖管理

 

```bash
# 获取依赖
flutter pub get

# 运行调试版本
flutter run

# 构建发布版本
flutter build apk --release
```
 

1. **日志监控**: 关注`LogUtil`输出的错误日志
2. **性能监控**: 使用`MemoryManager`监控内存使用
3. **用户反馈**: 及时处理用户反馈的问题
 
 重要文件清单

- `lib/main.dart`: 应用入口
- `lib/services/`: 核心服务目录
- `lib/network/`: 网络层实现
- `android/app/src/main/kotlin/.../MainActivity.kt`: 支付实现
- `privacy_compliance_test.md`: 隐私合规测试
- `打包说明.md`: 打包操作说明
 
 

